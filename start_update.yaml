---
    - hosts: all
      become: true
      vars:
        docker_image: "bitnami/wordpress:latest"
   
      tasks:  
        - name: rollback and backup user data
            include_tasks: rollback.yaml
        
        - name: update
          shell: |
              docker pull "{{ docker_image }}"
              docker stop "{{ name_cms }}"
              rsync -a /var/lib/docker/volumes/ /data/backups/wolumes.bkp.$(date +%Y%m%d-%H.%M.%S)
              docker rm "{{ name_cms }}"
              docker run --name "{{ name_cms }}" "{{ docker_image }}"
          args:
            executable: /bin/bash
          










        - name: add docker network
          shell: |
              docker volume create --name mariadb_data
              docker run -d --name mariadb \
              --env ALLOW_EMPTY_PASSWORD=yes \
              --env MARIADB_USER=bn_wordpress \
              --env MARIADB_DATABASE=bitnami_wordpress \
              --network wordpress-network \
              --volume mariadb_data:/bitnami/mariadb \
              bitnami/mariadb:latest
          args:
            executable: /bin/bash
        
        - name: add docker network
          shell: |
              docker run -d --name wordpress \
              -p 8080:8080 -p 8443:8443 \
              -e ALLOW_EMPTY_PASSWORD=yes \
              -e WORDPRESS_DATABASE_USER=bn_wordpress \
              -e WORDPRESS_DATABASE_NAME=bitnami_wordpress \
              --network wordpress-network \
              --volume wordpress_data:/date/wordpress \
              bitnami/wordpress:latest
          args:
            executable: /bin/bash